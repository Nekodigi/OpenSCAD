h = 100;
res = 100;
ns = 200;
twist = 180;
d = 2;

for(i = [0:res-1]){
    z = i/res;
    r = 0.7+ 0.4*sin(z*ns*1.9);
    zn = (i+1)/res;
    rn = 0.7+ 0.4*sin(zn*ns*1.9);
    s = rn/r;
    translate([0,0,h*z])
    rotate([0,0,-twist*z])
    linear_extrude(height=h/res, twist=twist/res, scale=s)
    scale(r)
    difference(){
        flake();
        if(h*z > d){
            offset(-d){
                flake();
            }
        }
    }
}
    
module flake(){
    translate([-25, -25/sqrt(3), 0])
    polygon(points=[[0, 0], [0.9259259259259257, 1.6037507477489603], [0.9259259259259257, 1.6037507477489603], [-2.220446049250313e-16, 3.2075014954979206], [-2.220446049250313e-16, 3.2075014954979206], [1.8518518518518514, 3.2075014954979206], [1.8518518518518514, 3.2075014954979206], [2.7777777777777772, 4.811252243246881], [2.7777777777777772, 4.811252243246881], [1.8518518518518512, 6.415002990995841], [1.8518518518518512, 6.415002990995841], [-6.661338147750939e-16, 6.415002990995841], [-6.661338147750939e-16, 6.415002990995841], [0.9259259259259252, 8.018753738744802], [0.9259259259259252, 8.018753738744802], [-8.881784197001252e-16, 9.622504486493762], [-8.881784197001252e-16, 9.622504486493762], [1.8518518518518507, 9.622504486493762], [1.8518518518518507, 9.622504486493762], [2.777777777777777, 11.226255234242723], [2.777777777777777, 11.226255234242723], [3.7037037037037024, 9.622504486493762], [3.7037037037037024, 9.622504486493762], [5.5555555555555545, 9.622504486493762], [5.5555555555555545, 9.622504486493762], [6.48148148148148, 11.226255234242723], [6.48148148148148, 11.226255234242723], [5.555555555555554, 12.830005981991683], [5.555555555555554, 12.830005981991683], [7.4074074074074066, 12.830005981991683], [7.4074074074074066, 12.830005981991683], [8.333333333333332, 14.433756729740644], [8.333333333333332, 14.433756729740644], [7.4074074074074066, 16.037507477489605], [7.4074074074074066, 16.037507477489605], [5.555555555555555, 16.037507477489605], [5.555555555555555, 16.037507477489605], [6.481481481481481, 17.641258225238563], [6.481481481481481, 17.641258225238563], [5.555555555555555, 19.245008972987524], [5.555555555555555, 19.245008972987524], [3.7037037037037033, 19.245008972987524], [3.7037037037037033, 19.245008972987524], [2.7777777777777772, 17.641258225238563], [2.7777777777777772, 17.641258225238563], [1.8518518518518512, 19.245008972987524], [1.8518518518518512, 19.245008972987524], [-8.881784197001252e-16, 19.245008972987524], [-8.881784197001252e-16, 19.245008972987524], [0.9259259259259253, 20.848759720736485], [0.9259259259259253, 20.848759720736485], [-2.220446049250313e-16, 22.452510468485443], [-2.220446049250313e-16, 22.452510468485443], [1.8518518518518514, 22.452510468485443], [1.8518518518518514, 22.452510468485443], [2.7777777777777777, 24.056261216234404], [2.7777777777777777, 24.056261216234404], [1.8518518518518519, 25.660011963983365], [1.8518518518518519, 25.660011963983365], [-8.881784197001252e-16, 25.660011963983365], [-8.881784197001252e-16, 25.660011963983365], [0.925925925925926, 27.263762711732326], [0.925925925925926, 27.263762711732326], [0.0, 28.867513459481287], [0.0, 28.867513459481287], [1.8518518518518514, 28.867513459481287], [1.8518518518518514, 28.867513459481287], [2.7777777777777772, 30.47126420723025], [2.7777777777777772, 30.47126420723025], [3.703703703703703, 28.867513459481287], [3.703703703703703, 28.867513459481287], [5.5555555555555545, 28.867513459481287], [5.5555555555555545, 28.867513459481287], [6.48148148148148, 30.47126420723025], [6.48148148148148, 30.47126420723025], [5.555555555555554, 32.07501495497921], [5.555555555555554, 32.07501495497921], [7.4074074074074066, 32.07501495497921], [7.4074074074074066, 32.07501495497921], [8.333333333333332, 33.67876570272817], [8.333333333333332, 33.67876570272817], [9.259259259259258, 32.07501495497921], [9.259259259259258, 32.07501495497921], [11.11111111111111, 32.07501495497921], [11.11111111111111, 32.07501495497921], [10.185185185185183, 30.47126420723025], [10.185185185185183, 30.47126420723025], [11.111111111111109, 28.867513459481287], [11.111111111111109, 28.867513459481287], [12.96296296296296, 28.867513459481287], [12.96296296296296, 28.867513459481287], [13.888888888888886, 30.47126420723025], [13.888888888888886, 30.47126420723025], [14.814814814814813, 28.867513459481287], [14.814814814814813, 28.867513459481287], [16.666666666666664, 28.867513459481287], [16.666666666666664, 28.867513459481287], [17.59259259259259, 30.47126420723025], [17.59259259259259, 30.47126420723025], [16.666666666666664, 32.07501495497921], [16.666666666666664, 32.07501495497921], [18.518518518518515, 32.07501495497921], [18.518518518518515, 32.07501495497921], [19.444444444444443, 33.67876570272817], [19.444444444444443, 33.67876570272817], [18.518518518518515, 35.28251645047713], [18.518518518518515, 35.28251645047713], [16.666666666666664, 35.28251645047713], [16.666666666666664, 35.28251645047713], [17.59259259259259, 36.88626719822609], [17.59259259259259, 36.88626719822609], [16.666666666666664, 38.490017945975055], [16.666666666666664, 38.490017945975055], [18.518518518518515, 38.490017945975055], [18.518518518518515, 38.490017945975055], [19.444444444444446, 40.093768693724016], [19.444444444444446, 40.093768693724016], [20.37037037037037, 38.49001794597505], [20.37037037037037, 38.49001794597505], [22.22222222222222, 38.49001794597505], [22.22222222222222, 38.49001794597505], [23.14814814814815, 40.09376869372401], [23.14814814814815, 40.09376869372401], [22.22222222222222, 41.69751944147297], [22.22222222222222, 41.69751944147297], [24.074074074074073, 41.69751944147297], [24.074074074074073, 41.69751944147297], [25.0, 43.30127018922193], [25.0, 43.30127018922193], [25.925925925925924, 41.69751944147297], [25.925925925925924, 41.69751944147297], [27.777777777777775, 41.69751944147297], [27.777777777777775, 41.69751944147297], [26.85185185185185, 40.09376869372401], [26.85185185185185, 40.09376869372401], [27.777777777777775, 38.49001794597505], [27.777777777777775, 38.49001794597505], [29.629629629629626, 38.49001794597505], [29.629629629629626, 38.49001794597505], [30.555555555555546, 40.093768693724016], [30.555555555555546, 40.093768693724016], [31.481481481481477, 38.490017945975055], [31.481481481481477, 38.490017945975055], [33.33333333333333, 38.490017945975055], [33.33333333333333, 38.490017945975055], [32.407407407407405, 36.88626719822609], [32.407407407407405, 36.88626719822609], [33.33333333333333, 35.28251645047713], [33.33333333333333, 35.28251645047713], [31.481481481481477, 35.28251645047713], [31.481481481481477, 35.28251645047713], [30.55555555555555, 33.67876570272817], [30.55555555555555, 33.67876570272817], [31.481481481481477, 32.07501495497921], [31.481481481481477, 32.07501495497921], [33.33333333333333, 32.07501495497921], [33.33333333333333, 32.07501495497921], [32.407407407407405, 30.47126420723025], [32.407407407407405, 30.47126420723025], [33.33333333333333, 28.867513459481287], [33.33333333333333, 28.867513459481287], [35.18518518518518, 28.867513459481287], [35.18518518518518, 28.867513459481287], [36.11111111111111, 30.47126420723025], [36.11111111111111, 30.47126420723025], [37.03703703703703, 28.867513459481287], [37.03703703703703, 28.867513459481287], [38.888888888888886, 28.867513459481287], [38.888888888888886, 28.867513459481287], [39.81481481481481, 30.47126420723025], [39.81481481481481, 30.47126420723025], [38.88888888888888, 32.07501495497921], [38.88888888888888, 32.07501495497921], [40.74074074074074, 32.07501495497921], [40.74074074074074, 32.07501495497921], [41.666666666666664, 33.67876570272817], [41.666666666666664, 33.67876570272817], [42.59259259259259, 32.07501495497921], [42.59259259259259, 32.07501495497921], [44.44444444444445, 32.07501495497921], [44.44444444444445, 32.07501495497921], [43.51851851851852, 30.47126420723025], [43.51851851851852, 30.47126420723025], [44.44444444444444, 28.867513459481287], [44.44444444444444, 28.867513459481287], [46.2962962962963, 28.867513459481287], [46.2962962962963, 28.867513459481287], [47.22222222222222, 30.47126420723025], [47.22222222222222, 30.47126420723025], [48.148148148148145, 28.867513459481287], [48.148148148148145, 28.867513459481287], [50.0, 28.867513459481287], [50.0, 28.867513459481287], [49.074074074074076, 27.263762711732326], [49.074074074074076, 27.263762711732326], [50.0, 25.660011963983365], [50.0, 25.660011963983365], [48.148148148148145, 25.66001196398337], [48.148148148148145, 25.66001196398337], [47.22222222222222, 24.056261216234407], [47.22222222222222, 24.056261216234407], [48.148148148148145, 22.452510468485446], [48.148148148148145, 22.452510468485446], [50.0, 22.452510468485443], [50.0, 22.452510468485443], [49.07407407407407, 20.848759720736485], [49.07407407407407, 20.848759720736485], [49.99999999999999, 19.245008972987524], [49.99999999999999, 19.245008972987524], [48.148148148148145, 19.245008972987524], [48.148148148148145, 19.245008972987524], [47.222222222222214, 17.64125822523857], [47.222222222222214, 17.64125822523857], [46.29629629629629, 19.245008972987527], [46.29629629629629, 19.245008972987527], [44.44444444444444, 19.245008972987527], [44.44444444444444, 19.245008972987527], [43.51851851851852, 17.641258225238566], [43.51851851851852, 17.641258225238566], [44.44444444444445, 16.037507477489605], [44.44444444444445, 16.037507477489605], [42.59259259259259, 16.037507477489605], [42.59259259259259, 16.037507477489605], [41.666666666666664, 14.433756729740644], [41.666666666666664, 14.433756729740644], [42.59259259259259, 12.830005981991684], [42.59259259259259, 12.830005981991684], [44.44444444444444, 12.830005981991684], [44.44444444444444, 12.830005981991684], [43.51851851851852, 11.226255234242725], [43.51851851851852, 11.226255234242725], [44.44444444444444, 9.622504486493764], [44.44444444444444, 9.622504486493764], [46.29629629629629, 9.622504486493764], [46.29629629629629, 9.622504486493764], [47.222222222222214, 11.226255234242723], [47.222222222222214, 11.226255234242723], [48.148148148148145, 9.622504486493764], [48.148148148148145, 9.622504486493764], [49.99999999999999, 9.622504486493764], [49.99999999999999, 9.622504486493764], [49.07407407407407, 8.018753738744802], [49.07407407407407, 8.018753738744802], [49.99999999999999, 6.415002990995845], [49.99999999999999, 6.415002990995845], [48.148148148148145, 6.415002990995843], [48.148148148148145, 6.415002990995843], [47.22222222222222, 4.811252243246882], [47.22222222222222, 4.811252243246882], [48.148148148148145, 3.2075014954979215], [48.148148148148145, 3.2075014954979215], [50.0, 3.2075014954979215], [50.0, 3.2075014954979215], [49.074074074074076, 1.6037507477489608], [49.074074074074076, 1.6037507477489608], [50.0, 0.0], [50.0, 0.0], [48.148148148148145, 0.0], [48.148148148148145, 0.0], [47.22222222222222, -1.603750747748961], [47.22222222222222, -1.603750747748961], [46.2962962962963, 0.0], [46.2962962962963, 0.0], [44.44444444444444, 0.0], [44.44444444444444, 0.0], [43.51851851851852, -1.6037507477489603], [43.51851851851852, -1.6037507477489603], [44.44444444444444, -3.207501495497919], [44.44444444444444, -3.207501495497919], [42.592592592592595, -3.2075014954979206], [42.592592592592595, -3.2075014954979206], [41.66666666666667, -4.811252243246881], [41.66666666666667, -4.811252243246881], [40.74074074074075, -3.2075014954979206], [40.74074074074075, -3.2075014954979206], [38.8888888888889, -3.207501495497921], [38.8888888888889, -3.207501495497921], [39.81481481481482, -1.6037507477489603], [39.81481481481482, -1.6037507477489603], [38.88888888888889, 0.0], [38.88888888888889, 0.0], [37.03703703703704, 0.0], [37.03703703703704, 0.0], [36.111111111111114, -1.603750747748961], [36.111111111111114, -1.603750747748961], [35.18518518518519, 0.0], [35.18518518518519, 0.0], [33.333333333333336, 0.0], [33.333333333333336, 0.0], [32.40740740740741, -1.6037507477489605], [32.40740740740741, -1.6037507477489605], [33.333333333333336, -3.2075014954979215], [33.333333333333336, -3.2075014954979215], [31.481481481481485, -3.207501495497921], [31.481481481481485, -3.207501495497921], [30.555555555555557, -4.811252243246882], [30.555555555555557, -4.811252243246882], [31.481481481481485, -6.415002990995842], [31.481481481481485, -6.415002990995842], [33.333333333333336, -6.415002990995842], [33.333333333333336, -6.415002990995842], [32.40740740740741, -8.018753738744802], [32.40740740740741, -8.018753738744802], [33.333333333333336, -9.622504486493764], [33.333333333333336, -9.622504486493764], [31.481481481481485, -9.622504486493764], [31.481481481481485, -9.622504486493764], [30.555555555555557, -11.226255234242725], [30.555555555555557, -11.226255234242725], [29.62962962962963, -9.622504486493764], [29.62962962962963, -9.622504486493764], [27.77777777777778, -9.622504486493764], [27.77777777777778, -9.622504486493764], [26.85185185185185, -11.226255234242725], [26.85185185185185, -11.226255234242725], [27.77777777777778, -12.830005981991686], [27.77777777777778, -12.830005981991686], [25.925925925925927, -12.830005981991684], [25.925925925925927, -12.830005981991684], [25.0, -14.433756729740645], [25.0, -14.433756729740645], [24.074074074074076, -12.830005981991684], [24.074074074074076, -12.830005981991684], [22.222222222222225, -12.830005981991684], [22.222222222222225, -12.830005981991684], [23.14814814814815, -11.226255234242725], [23.14814814814815, -11.226255234242725], [22.222222222222225, -9.622504486493764], [22.222222222222225, -9.622504486493764], [20.370370370370374, -9.622504486493764], [20.370370370370374, -9.622504486493764], [19.444444444444446, -11.226255234242725], [19.444444444444446, -11.226255234242725], [18.51851851851852, -9.622504486493762], [18.51851851851852, -9.622504486493762], [16.666666666666668, -9.622504486493762], [16.666666666666668, -9.622504486493762], [17.592592592592595, -8.018753738744802], [17.592592592592595, -8.018753738744802], [16.666666666666668, -6.41500299099584], [16.666666666666668, -6.41500299099584], [18.518518518518523, -6.415002990995842], [18.518518518518523, -6.415002990995842], [19.44444444444445, -4.811252243246882], [19.44444444444445, -4.811252243246882], [18.518518518518523, -3.2075014954979215], [18.518518518518523, -3.2075014954979215], [16.66666666666667, -3.2075014954979215], [16.66666666666667, -3.2075014954979215], [17.5925925925926, -1.6037507477489608], [17.5925925925926, -1.6037507477489608], [16.66666666666667, 0.0], [16.66666666666667, 0.0], [14.814814814814818, 0.0], [14.814814814814818, 0.0], [13.888888888888893, -1.603750747748961], [13.888888888888893, -1.603750747748961], [12.962962962962967, 0.0], [12.962962962962967, 0.0], [11.111111111111114, 0.0], [11.111111111111114, 0.0], [10.185185185185189, -1.6037507477489608], [10.185185185185189, -1.6037507477489608], [11.111111111111114, -3.207501495497922], [11.111111111111114, -3.207501495497922], [9.259259259259261, -3.2075014954979215], [9.259259259259261, -3.2075014954979215], [8.333333333333336, -4.811252243246883], [8.333333333333336, -4.811252243246883], [7.407407407407409, -3.207501495497922], [7.407407407407409, -3.207501495497922], [5.555555555555557, -3.207501495497922], [5.555555555555557, -3.207501495497922], [6.481481481481484, -1.6037507477489612], [6.481481481481484, -1.6037507477489612], [5.555555555555557, 0.0], [5.555555555555557, 0.0], [3.703703703703705, 0.0], [3.703703703703705, 0.0], [2.7777777777777786, -1.603750747748961], [2.7777777777777786, -1.603750747748961], [1.8518518518518525, 0.0], [1.8518518518518525, 0.0], [0, 0]]);
};

